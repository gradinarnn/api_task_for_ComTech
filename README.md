# Тестовое задание для компании "Комтек"

## Запуск проекта
Используется база данных PostgreSQL. Данные в проекте для подключения к бд:
```
'NAME': 'postgres',
'USER' : 'postgres',
'PASSWORD' : 'postgres',
'HOST' : 'localhost',
'PORT' : '5432'
```
Параметры подключения к базе данных можно поменять в /com_tech_test/com_tech_test/settings.py в разделе DATABASES

Установка пакетов:
```
pip install -r requirements.txt
```
Миграции:
```
python .\manage.py makemigrations
python .\manage.py migrate
python .\manage.py makemigrations api
python .\manage.py migrate api
```
Создание пользователя для работы с админ понелью:
```
python .\manage.py createsuperuser
```
Запуск:\
находясь в директории \com_tech_test\
```
python .\manage.py runserver
```
либо, чтобы сервер работал на порте 8080
```
python .\manage.py runserver 8080
```
админ панель будет доступна по адресу: http://127.0.0.1:8000/admin/ либо http://127.0.0.1:8080/admin/

Мне нравится порт 8080, поэтому я буду работать с ним

## Примеры работы с API

1. Получение списка всех справочников:  
Отправляем  GET запрос без параметров: http://127.0.0.1:8080/api/v1/catalogs/ \
Ответ:  
```json
[
    {
        "id": 2,
        "short_title": "Бол",
        "full_title": "Болезни",
        "description": "Болезни и их названия",
        "version": "1",
        "start_date": "2002-04-09"
    },
    {
        "id": 1,
        "short_title": "Спец",
        "full_title": "Специальности",
        "description": "врачи специальности",
        "version": "2",
        "start_date": "2022-01-01"
    },
    {
        "id": 3,
        "short_title": "Спец",
        "full_title": "Специальности",
        "description": "",
        "version": "1",
        "start_date": "2020-04-09"
    }
    ]

```
2. Получение списка справочников, актуальных на указанную дату:
Пример GET запроса(date должна быть в формате YYYY-MM-DD): http://127.0.0.1:8080/api/v1/catalogs/?date=2020-04-09 \
Ответ:  
```json
[
    {
        "id": 2,
        "short_title": "Бол",
        "full_title": "Болезни",
        "description": "Болезни и их названия",
        "version": "1",
        "start_date": "2002-04-09"
    },
    {
        "id": 3,
        "short_title": "Спец",
        "full_title": "Специальности",
        "description": "",
        "version": "1",
        "start_date": "2020-03-01"
    }
]
```

3. Получение всех элементов заданного справочника текущей версии \
Текущая версия подразумевает, что у этого справочника дата начала действия максимально приближена ко дню отправления запроса
- Тип запроса: GET;
- Параметры запроса: 
    - catalog_full_title - полное имя каталога,
    - actual - небходимо значение для этого параметра "true"(если в запросе также будет присутсвовать 
  поле catalog_version, то будет выдан справочник по версии а не по актуальности); 
  
Пример GET запроса: http://127.0.0.1:8080/api/v1/items/?catalog_full_title=Специальности&actual=true \
Ответ:  
```json
{
    "id": 1,
    "short_title": "Спец",
    "full_title": "Специальности",
    "description": "врачи специальности",
    "version": "2",
    "start_date": "2022-01-01",
    "elements": [
        {
            "id": 1,
            "parent_id": null,
            "code": "123",
            "value": "Галина Овечкина",
            "catalog": 1
        },
        {
            "id": 2,
            "parent_id": null,
            "code": "081",
            "value": "Николай Иванов",
            "catalog": 1
        }
    ]
}
```
4. Получение всех элементов заданного справочника указанной версии \
- Тип запроса: GET;
- Параметры запроса: 
    - catalog_full_title - полное имя каталога,
    - catalog_version - версия каталога; 
  
Пример GET запроса: http://127.0.0.1:8080/api/v1/items/?catalog_full_title=Специальности&catalog_version=2 \
Ответ:  
```json
{
    "id": 1,
    "short_title": "Спец",
    "full_title": "Специальности",
    "description": "врачи специальности",
    "version": "2",
    "start_date": "2022-01-01",
    "elements": [
        {
            "id": 1,
            "parent_id": null,
            "code": "123",
            "value": "Галина Овечкина",
            "catalog": 1
        },
        {
            "id": 2,
            "parent_id": null,
            "code": "081",
            "value": "Николай Иванов",
            "catalog": 1
        }
    ]
}
```
5. Валидация элементов заданного справочника указанной версии  
- Тип запроса: POST;
- Тело запроса(payload): 
    - catalog_full_title - полное имя каталога,
    - catalog_version - версия каталога,
    - elements - элементы каталога для валидации:
        - parent_id - родительский идентификатор элемента справочника,
        - code - код элемента справочника,
        - value - значение элемента справочника; 

Пример POST запроса: http://127.0.0.1:8080/api/v1/items/validation/ \
payload:
```json
{
  "catalog_full_title": "Специальности",
  "catalog_version": 2,
  "elements": [
    {
      "parent_id": null,
      "code": "39821173",
      "value": "Вася"
    },
    {
      "parent_id": 1,
      "code": null,
      "value": "unknown"
    },
    {
      "parent_id": 1,
      "code": "asdf",
      "value": "unknown"
    }
  ]
}
```
Ответ:  
```json
{
    "valid_elements": [
        [
            {
                "id": 1,
                "parent_id": null,
                "code": "123",
                "value": "Галина Овечкина",
                "catalog": 1
            }
        ]
    ]
}
```



6. Валидация элементов заданного справочника текущей версии 
Текущая версия подразумевает, что у этого справочника дата начала действия максимально приближена ко дню отправления запроса
- Тип запроса: POST;
- Тело запроса(payload): 
    - catalog_full_title - полное имя каталога,
    - actual - небходимо значение для этого параметра "true"(если в запросе также будет присутсвовать 
  поле catalog_version, то будет выдан справочник по версии, а не по актуальности),
    - elements - элементы каталога для валидации:
        - parent_id - родительский идентификатор элемента справочника,
        - code - код элемента справочника,
        - value - значение элемента справочника; 

Пример POST запроса: http://127.0.0.1:8080/api/v1/items/validation/ \
payload:
```json
{
  "catalog_full_title": "Специальности",
  "actual": "true",
  "elements": [
    {
      "parent_id": null,
      "code": "39821173",
      "value": "Вася"
    },
    {
      "parent_id": null,
      "code": 123,
      "value": "Галина Овечкина"
    },
    {
      "parent_id": 1,
      "code": "asdf",
      "value": "unknown"
    }
  ]
}
```
Ответ:  
```json
{
    "valid_elements": [
        [
            {
                "id": 1,
                "parent_id": null,
                "code": "123",
                "value": "Галина Овечкина",
                "catalog": 1
            }
        ]
    ]
}
```
# Комтек ТЗ Python

Разработать сервис терминологии и REST API к нему.



## Описание

Сервис терминологии оперирует ниже перечисленными сущностями.



Сущность "Справочник" содержит следующие атрибуты:

- идентификатор справочника (глобальный и не зависит от версии)
- наименование
- короткое наименование
- описание
- версия (тип: строка,  не может быть пустой, уникальная в пределах одного справочника)
- дата начала действия справочника этой версии



Сущность "Элемент справочника"

- идентификатор
- родительский идентификатор
- код элемента (тип: строка, не может быть пустой)
- значение элемента (тип: строка, не может быть пустой)



API должно предоставлять следующие методы:

- получение списка справочников.
- получение списка справочников, актуальных на указанную дату
- получение элементов заданного справочника текущей версии
- валидация элементов заданного справочника текущей версии
- получение элементов заданного справочника указанной версии
- валидация элемента заданного справочника по указанной версии



В API должен быть предусмотрен постраничный вывод результата (данные должны возвращаться частями по 10 элементов).

К сервису должна иметься GUI административной части, с помощью которой можно добавлять новые справочники, новые версии справочников, указывать дату начала действия и наполнять справочники элементами.

## Технологии

* Python >= 3.8

## Критерии оценки

* Выполнение требований ТЗ.
* Читаемость программного кода (отступы, разделители и т.д.).
* Адекватность выбора подхода: технологий, конструкций языка.
* Наличие в коде программы комментариев и их содержание.
* Невозможность внесения некорректных данных пользователем.
* Наличие ошибок в программе (неожиданное поведение, не корректные выходные данные), в том числе возникающих при непредусмотренных действиях пользователей.
* Удобство использования (логичность элементов API и GUI-интерфейса).
* Наличие описания разработанного API с примерами.
